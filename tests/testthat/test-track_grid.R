dimension <- c(50, 35)
extent <- c(range(trips0$x), range(trips0$y))

cells <- c(585, 536, 535, 536, 536, 537, 536, 537, 487, 537, 488, 487,
  439, 440, 440, 441, 391, 390, 389, 390, 390, 391, 392, 392, 442,
  393, 343, 342, 391, 391, 392, 392, 392, 392, 391, 392, 342, 342,
  343, 397, 394, 394, 395, 447, 347, 396, 396, 446, 395, 396, 396,
  396, 498, 447, 447, 446, 396, 446, 446, 446, 446, 447, 496, 496,
  498, 547, 547, 547, 546, 544, 546, 547, 547, 546, 496, 496, 180,
  496, 547, 546, 598, 596, 647, 645, 695, 696, 696, 646, 645, 697,
  697, 696, 697, 747, 796, 950, 796, 795, 795, 297, 846, 846, 846,
  896, 946, 896, 946, 946, 946, 890, 896, 1390, 947, 997, 997,
  997, 997, 997, 998, 1048, 1048, 1049, 948, 1049, 1049, 1199,
  1049, 1048, 1048, 1048, 1048, 1000, 1047, 1048, 1048, 1048, 1049,
  998, 998, 998, 997, 947, 947, 997, 997, 997, 996, 946, 996, 945,
  945, 945, 945, 945, 945, 945, 944, 943, 943, 894, 944, 894, 944,
  894, 944, 945, 945, 945, 944, 944, 944, 944, 944, 944, 944, 943,
  893, 893, 892, 893, 842, 842, 840, 841, 841, 841, 890, 791, 841,
  891, 891, 940, 840, 840, 789, 435, 890, 890, 840, 840, 889, 839,
  839, 891, 839, 839, 842, 839, 839, 839, 839, 840, 1233, 889,
  889, 889, 889, 890, 886, 1050, 889, 888, 838, 939, 988, 1037,
  1038, 1038, 1087, 1037, 1038, 1282, 1600, 1037, 1037, 1086, 1086,
  1036, 1086, 1086, 1087, 1086, 1086, 1085, 1134, 1590, 1137, 1136,
  1136, 1185, 1185, 1234, 1123, 1234, 1284, 1284, 1284, 1334, 1334,
  1334, 1334, 1279, 1334, 1435, 1535, 1333, 1332, 1333, 1332, 1332,
  1382, 1382, 1382, 1431, 1383, 1383, 1383, 1383, 1282, 1333, 1632,
  1332, 1332, 1331, 1331, 1381, 1335, 1331, 1330, 1329, 1329, 1281,
  1329, 1379, 1329, 1329, 1278, 1279, 1229, 1179, 1130, 1129, 1079,
  1180, 1129, 1079, 1128, 1128, 1128, 1077, 1076, 1076, 1026, 1026,
  1026, 1026, 1026, 975, 925, 975, 924, 925, 975, 976, 927, 878,
  926, 875, 825, 825, 825, 873, 926, 826, 826, 826, 777, 776, 777,
  777, 726, 727, 676, 676, 625, 575, 574, 667, 523, 523, 523, 473,
  521, 522, 472, 472, 471, 421, 421, 421, 421, 420, 421, 371, 372,
  422, 421, 371, 472, 421, 370, 420, 370, 420, 371, 371, 421, 421,
  421, 517, 421, 421, 421, 421, 421, 421, 420, 421, 471, 470, 470,
  471, 471, 472, 574, 624, 572, 622, 522, 522, 522, 571, 571, 571,
  571, 571, 571, 571, 571, 620, 620, 572, 521, 621, 570, 622, 572,
  622, 624, 623, 1138, 573, 574, 574, 625, 625, 625, 625, 673,
  674, 674, 723, 723, 723, 723, 824, 771, 675, 773, 724, 774, 774,
  773, 774, 873, 823, 823, 776, 823, 823, 822, 773, 723, 723, 723,
  773, 774, 775, 726, 725, 725, 725, 726, 727, 728, 676, 677, 678,
  729, 679, 779, 729, 729, 729, 728, 729, 681, 680, 680, 630, 631,
  631, 581, 581, 581, 581, 582, 583, 583, 583, 584, 584, 583, 633,
  633, 584, 534, 534, 585, 585, 631, 632, 632, 631, 631, 631, 632,
  632, 633, 634, 533, 583, 584, 584, 534, 536, 483, 534, 433, 484,
  434, 433, 433, 433, 430, 432, 382, 431, 383, 385, 383, 333, 333,
  333, 333, 334, 335, 285, 285, 336, 335, 285, 286, 287, 286, 286,
  286, 286, 339, 286, 286, 287, 287, 336, 337, 338, 39, 389, 389,
  389, 389, 389, 439, 440, 440, 440, 440, 438, 490, 490, 490, 491,
  540, 541, 541, 591, 591, 641, 591, 592, 543, 543, 593, 693, 595,
  595, 644, 695, 694, 693, 693, 743, 694, 744, 743, 794, 793, 794,
  794, 845, 845, 846, 896, 896, 946, 946, 946, 947, 949, 947, 997,
  995, 997, 997, 998, 1048, 1099, 896, 999, 1049, 1049, 1048, 1048,
  998, 998, 1048, 1048, 998, 1049, 999, 999, 1000, 1100, 1049,
  1050, 1050, 1000, 1000, 1000, 1000, 1000, 999, 998, 994, 947,
  997, 946, 946, 946, 947, 946, 997, 995, 995, 995, 945, 945, 945,
  945, 945, 945, 897, 896, 946, 945, 896, 896, 896, 895, 896, 846,
  895, 846, 845, 845, 795, 844, 895, 844, 844, 896, 844, 893, 893,
  893, 894, 893, 893, 893, 893, 993, 894, 892, 892, 892, 892, 893,
  892, 893, 894, 894, 943, 648, 843, 893, 893, 892, 892, 892, 891,
  890, 889, 938, 888, 837, 836, 886, 887, 887, 886, 837, 886, 887,
  838, 888, 888, 888, 837, 837, 837, 836, 837, 886, 787, 837, 837,
  837, 837, 838, 838, 837, 887, 887, 936, 987, 986, 987, 985, 1037,
  1037, 1037, 1037, 1036, 1036, 1037, 1087, 1036, 1036, 1136, 1135,
  1134, 1182, 1183, 1233, 1182, 1182, 1182, 1182, 1131, 1229, 1180,
  1179, 1178, 1178, 1229, 1177, 1277, 1277, 1276, 1276, 1028, 1226,
  1274, 1324, 1324, 1274, 1324, 1275, 1324, 1274, 1273, 1274, 1274,
  1273, 1274, 1323, 1323, 1274, 1325, 1274, 1323, 1322, 1325, 1272,
  1273, 1273, 1272, 1222, 1372, 1422, 1270, 1270, 1219, 1219, 1219,
  1219, 1167, 1219, 1221, 1169, 1169, 1166, 1171, 1168, 1167, 1167,
  1117, 1167, 1167, 1167, 1116, 1116, 1166, 1116, 1066, 1015, 1065,
  1014, 1014, 964, 963, 963, 962, 962, 911, 912, 862, 913, 863,
  862, 912, 311, 862, 811, 761, 812, 812, 811, 810, 760, 760, 760,
  760, 759, 759, 759, 761, 760, 709, 710, 610, 661, 660, 660, 609,
  661, 663, 562, 613, 562, 562, 512, 512, 512, 512, 512, 514, 516,
  464, 513, 512, 463, 463, 464, 464, 464, 413, 516, 17, 514, 464,
  413, 514, 515, 617, 514, 514, 564, 564, 515, 566, 614, 565, 615,
  566, 567, 617, 617, 366, 668, 668, 718, 719, 719, 719, 718, 767,
  770, 770, 771, 722, 821, 821, 871, 871, 922, 970, 921, 971, 971,
  971, 971, 1021, 1121, 972, 972, 972, 1022, 1022, 972, 1021, 1021,
  1074, 972, 872, 972, 973, 1422, 1023, 924, 1024, 1022, 975, 975,
  977, 927, 927, 927, 925, 877, 878, 927, 927, 927, 927, 878, 928,
  979, 979, 929, 929, 930, 931, 931, 932, 882, 881, 881, 781, 832,
  782, 783, 783, 783, 782, 732, 731, 630, 681, 681, 728, 778, 727,
  677, 678, 678, 678, 629, 629, 629, 630, 631, 532, 581, 580, 581,
  584, 582, 532, 533, 533, 583, 531, 380, 533, 533, 481, 533, 533,
  483, 532, 432, 484, 485, 485, 486, 486, 486, 436, 436, 192, 487,
  537, 587, 537, 537, 489, 537, 587, 587, 638, 638, 638, 637, 586,
  637, 636, 638, 638, 637, 688, 738, 688, 688, 687, 687, 737, 737,
  787, 839, 838, 838, 839, 889, 889, 1038, 989, 991, 991, 1041,
  1041, 1041, 895, 1042, 994, 1094, 1044, 1044, 1094, 1094, 1094,
  1196, 1145, 1145, 1196, 1196, 1246, 1246, 1296, 1297, 1298, 1298,
  1298, 1297, 1297, 1349, 1398, 1348, 1348, 1347, 1346, 1346, 1345,
  1395, 1394, 1394, 1393, 1344, 1394, 1393, 1343, 1393, 1443, 1443,
  1443, 1443, 1393, 1444, 1444, 1442, 1443, 1442, 1443, 1693, 1442,
  1441, 1492, 1441, 1441, 1390, 1288, 1390, 1389, 1389, 1389, 1390,
  1390, 1390, 1391, 1391, 1390, 1190, 1391, 1391, 1390, 1389, 1389,
  1389, 1388, 1338, 1339, 1339, 1340, 1290, 1290, 1290, 1290, 1240,
  1239, 1239, 1240, 1649, 1240, 1239, 1240, 1190, 1288, 1189, 1189,
  1189, 1187, 1139, 1139, 1138, 1139, 1088, 1088, 1137, 1087, 1087,
  1036, 1036, 1035, 1035, 1085, 1035, 1035, 1085, 1085, 1085, 1085,
  1084, 1529, 1085, 1036, 1035, 1087, 1085, 1085, 1135, 1134, 1135,
  1134, 1134, 1134, 1234, 1184, 1183, 1183, 1133, 1133, 1182, 1183,
  1182, 1231, 1231, 1330, 1231, 1231, 1183, 1281, 1331, 1331, 1381,
  1381, 1381, 1381, 1381, 1431, 1431, 1431, 1431, 1481, 1481, 1531,
  1532, 1531, 1530, 1580, 1580, 1630, 1630, 1679, 1678, 1678, 1627,
  1675, 1678, 1678, 1679, 1679, 1629, 1629, 1677, 1678, 1677, 1677,
  1726, 1725, 1726, 1725, 1725, 1676, 1676, 1675, 1675, 1674, 1674,
  1673, 1673, 1623, 1623, 1623, 1623, 1623, 1721, 1673, 1722, 1673,
  1673, 1673, 1674, 1725, 1673, 1673, 1673, 1673, 1673, 1673, 1673,
  1722, 1671, 1721, 1670, 1621, 1621, 1621, 1619, 1619, 1619, 1570,
  1568, 1567, 1518, 1567, 1467, 1417, 1417, 1467, 1417, 1418, 1418,
  1468, 1419, 1368, 1369, 1371, 1368, 1368, 1369, 1317, 1269, 1317,
  1267, 1318, 1216, 1166, 1166, 1166, 1266, 1116, 1116, 1116, 1067,
  1068, 1117, 1117, 1066, 1166, 1065, 1066, 1015, 1014, 1014, 964,
  963, 963, 913, 913, 913, 863, 863, 863, 863, 863, 864, 813, 863,
  764, 812, 714, 762, 762, 712, 762, 812, 762, 763, 712, 1201,
  660, 763, 763, 762, 762, 763, 814, 763, 762, 762, 763, 713, 762,
  762, 762, 762, 762, 719, 813, 864, 814, 863, 813, 864, 863, 863,
  863, 913, 914, 914, 913, 964, 964, 1053, 913, 1015, 1014, 1014,
  1064, 1064, 1063, 1013, 1014, 1064, 1259, 1063, 1065, 1063, 1063,
  1114, 1214, 1114, 1115, 1062, 1115, 1115, 1165, 1166, 1166, 1166,
  1167, 1017, 1167, 1066, 1168, 1168, 1218, 1217, 1217, 1217, 1267,
  1268, 1267, 1267, 1268, 1319, 1268, 1268, 1268, 1268, 1268, 1269,
  1270, 1220, 1221, 1119, 1221, 1220, 1222, 1172, 1171, 1122, 1122,
  1172, 1172, 1171, 1121, 1120, 1072, 1072, 1071, 1072, 970, 1024,
  1074, 1026, 974, 973, 973, 974, 924, 875, 826, 826, 776, 826,
  775, 776, 776, 727)

#cells2 <- track_grid(trips0$x, trips0$y, dimension = c(5, 3))
#dput(table(cells2))
tabcells2 <- structure(c(`2` = 43L, `3` = 57L, `4` = 126L, `5` = 73L, `6` = 17L,
            `7` = 161L, `8` = 206L, `9` = 215L, `10` = 254L, `11` = 2L, `12` = 69L,
            `13` = 120L, `14` = 107L, `15` = 50L), dim = 14L, dimnames = structure(list(
              c("2", "3", "4", "5", "6", "7", "8", "9", "10",
                         "11", "12", "13", "14", "15")), names = ""), class = "table")

test_that("grid works", {
  expect_equal(track_grid(trips0$x, trips0$y, dimension = dimension, extent = extent), cells)
  ## also the same if we don't provide extent
  expect_equal(track_grid(trips0$x, trips0$y, dimension = dimension), cells)

  expect_equal(table(track_grid(trips0$x, trips0$y, dimension = c(5, 3))), tabcells2)
})
