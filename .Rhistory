purrr::transpose() %>%
purrr::map(~{browser(); tibble::tibble(x = approx(.x$x, .x$x1, n = .x$nn)$y)})
.x
approx(.x$x, .x$x1, n = .x$nn)
?approx
.x$x
.x$x1
.x$nn
approx(c(.x$x, .x$x1), n = .x$nn)
approx(c(.x$x, .x$x1), n = .x$nn)$y
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{browser(); tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point()
library(ggplot2)
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_line(data = x)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_line(data = x, colour = "black")
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_path(data = x, colour = "black")
library(trip)
x <- triplib::trips0
diff(x$date)
library(dplyr)
library(ggplot2)
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_path(data = x, colour = "black")
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
})
plot(tr)
plot(tr$x, tr$y, pch = ".")
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
tr
g <- raster::raster(tr[c("x", "y")])
g
g <- raster::raster(as.matrix(tr[c("x", "y")]))
g
g <- raster::raster(raster::extent(as.matrix(tr[c("x", "y")])))
g
g <- raster::raster(raster::extent(as.matrix(tr[c("x", "y")])), res = .2)
g
cell <- raster::cellFromXY(g, tr[c("x", "y")])
cell <- raster::cellFromXY(g, as.matrix(tr[c("x", "y")]))
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell
cell <- cell %>% group_by(object_) %>% count()
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% tally()
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% summarize(n = n())
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% summarize(n = sum(n()))
cell
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell
cell <- cell %>% group_by(cell_) %>% summarize(n = sum(n()))
cell
g[cell$cell_] <- cell$n
plot(g)
plot(aggregate(g,fact = 8, fun = sum))
plot(raster::aggregate(g,fact = 8, fun = sum))
lines(tr$x, tr$y)
trp <- trip(tr)
trp <- trip(x)
plot(trp)
system.time({
trip:::interpequal(trp, dur = diftime)})
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
system.time({
aa <- trip:::interpequal(trp, dur = diftime)})
library(furrr)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
x <- do.call(rbind, replicate(x, 100, simplify = FALSE))
x <- do.call(rbind, replicate(100, x, simplify = FALSE))
dim(x)
dim(triplib::trips0)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
plan(multifork)
library(trip)
x <- triplib::trips0
x <- do.call(rbind, replicate(10, x, simplify = FALSE))
diff(x$date)
library(dplyr)
library(ggplot2)
diftime <- 36
library(furrr)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
trp <- trip(x)
system.time({
aa <- trip:::interpequal(trp, dur = diftime)})
dim(trp)
class(0)
mode(0)
devtools::load_all(".")
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
speed = track_speed(x, y, date))
library(triplib)
library(tidyverse)
## there's no grouping here - we haven't gotten our data organized yet
trips0 %>% mutate(distance = track_distance(x, y), angle = track_angle(x, y))
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
speed = track_speed(x, y, date))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
devtools::load_all(".")
track_time(trips0$date)[1:10]
diff(trips0$date)[1:10]
157.03333 * 60
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point()
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point() +
facet_grid(~id)
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point() +
facet_grid(~id, col = 1)
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point() +
facet_grid(~id, cols = 1)
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point() +
facet_wrap(~id, cols = 1)
metric %>%
ggplot(aes(date, x, colour = speed)) + geom_point() +
facet_wrap(~id, ncol = 1)
metric %>%
ggplot(aes(date, x, colour = turn)) + geom_point() +
facet_wrap(~id, ncol = 1)
metric %>%
ggplot(aes(date, x, colour = angle)) + geom_point() +
facet_wrap(~id, ncol = 1)
library(amt)
make_track(trips0)
make_track(trips0, x, y, date)
make_track(trips0, x, y, date) %>% amt::summarise()
make_track(trips0, x, y, date) %>% amt::seconds()
sum(metric$duration)
sum(metric$duration, na.rm = TRUE)
trip::trip(trips0)
s <- summary(trip::trip(trips0))
str(s)
library(trip)
s <- summary(trip::trip(trips0))
str(s)
s$tripDurationSeconds
sum(s$tripDurationSeconds)
sum(metric$duration, na.rm = TRUE)
sum(trackDistance(trip::trip(trips0)))
sum(metric$distance)
sum(metric$distance, na.rm - T)
sum(metric$distance, na.rm = T)
sum(metric$distance, na.rm = T)/1000
devtools::load_all(".")
track_distance_to(trips0$x, trips0$y, 0, 0)
devtools::load_all(".")
track_distance_to(trips0$x, trips0$y, 0, 0)
devtools::load_all(".")
track_distance_to(trips0$x, trips0$y, to_x = 147, to_y = -42)[1:10]
library(triplib)
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42))
metric
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_point(data = data.frame(x = 147, y = -42), pch = "+", cex = 2)
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_point(data = data.frame(x = 147, y = -42), pch = "+", cex = 2)
metric
metric %>%
ggplot(aes(x, y, colour = distance_to))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_point(data = data.frame(x = 147, y = -42), pch = "+", cex = 2, colour = NULL)
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_point(data = data.frame(x = 147, y = -42), pch = "+", cex = 2, colour = NA)
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_point(data = data.frame(x = 147, y = -42, distance_to = 0))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
track_bearing_to(trips0$x, trips0$y, to_x = 147, to_y = -42)[1:10]
library(triplib)
plot(trips0[1:10, 1:2])
plot(trips0[1:10, 1:2], xlim = c(110, 150), ylim = c(-43, -39))
points(147, -42)
?bearing
bearing(cbind(0, 0), cbind(c(0, 100, 100, 100), c(90, 45, -45, -60)))
geosphere::bearing(cbind(0, 0), cbind(c(0, 100, 100, 100), c(90, 45, -45, -60)))
track_bearing_to(0,0, c(0, 10, 0, -10), c(5, 0, -5, 0))
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42),
bearing_to = track_bearing(to, xy, 147, -42))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
devtools::load_all(".")
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42),
bearing_to = track_bearing(to, xy, 147, -42))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
library(triplib)
devtools::load_all(".")
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42),
bearing_to = track_bearing_to(x, y, 147, -42))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, bearing_to = 0),
label = "home")
range(metric$bearing_to)
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42),
bearing_to = track_bearing_to(x, y, -147, -42))
metric
metric %>%
ggplot(aes(x, y, cex= 1/angle)) +
geom_point() +
geom_path(col = rgb(0.2, 0.2, 0.2, 0.2))
metric %>%
ggplot(aes(x, y, colour = distance_to)) +
geom_point() + geom_label(data = data.frame(x = 147, y = -42, distance_to = 0),
label = "home")
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = -147, y = -42, bearing_to = 0),
label = "home")
range(metric$bearing_to)
## now we group by id (also need arrange by date to be sure ...)
metric <- trips0 %>% group_by(id) %>% mutate(distance = track_distance(x, y),
angle = track_angle(x, y),
turn = track_turn(x, y),
bearing = track_bearing(x, y),
duration = track_time(date),
speed = track_speed(x, y, date),
distance_to = track_distance_to(x, y, 147, -42),
bearing_to = track_bearing_to(x, y, 100, -42))
metric %>%
ggplot(aes(x, y, colour = bearing_to)) +
geom_point() + geom_label(data = data.frame(x = 100, y = -42, bearing_to = 0),
label = "home")
pkgdown::build_site()
pkgdown::build_site()
