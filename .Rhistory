x$Deployment
x <- trips0[1:30, ]
x <- triplib::trips0[1:30, ]
library(triplib)
library(trip)
x <- triplib::trips0[1:30, ]
diff(x$date)
x %>% group_by(x, id)
library(dplyr)
x %>% group_by(x, id)
x %>% group_by(x, id) %>%
mutate(df = lag(date))
?lag
lead(1:10, 1)
x %>% group_by(x, id) %>%
mutate(df = lead(date))
x %>% #group_by(x, id) %>%
mutate(df = lead(date))
x %>% group_by(id) %>%
mutate(df = lead(date))
x %>% group_by(id) %>%
mutate(df = lag(date))
x %>% group_by(id) %>%
mutate(duration = lead(date) - date)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date)) - unclass(date))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = duration / 60)
diftime <- 60
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = max(c(round(duration / diftime), 3)))
library(trip)
x <- triplib::trips0[1:30, ]
diff(x$date)
library(dplyr)
diftime <- 60
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = max(c(round(duration / diftime), 3)))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(c(round(duration / diftime), 3)))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = round(duration / diftime)))
diftime <- 3600
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = round(duration / diftime))
diftime <- 36000
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = round(duration / diftime))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = round(duration / diftime)) %>%
mutate(nn = pmax(3, nn))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime)))
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime)))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%
ungroup() %>%
purrr::transpose() %>%
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(35:30)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(25:30)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%
ungroup()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%  as.data.frame()
option(max.print = 20000)
options(max.print = 20000)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%  as.data.frame()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
#slice(-1) %>%
as.data.frame()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-1) %>%
as.data.frame()
x
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
as.data.frame()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n())
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~tibble::tibble(x = approx(x, x1, n = nn)))
elke
plot(1)
text(1,1, "elke")
plot(1, type = "n")
text(1,1, "elke")
text(rnorm(100),rnorm(100), "elke")
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
text(rnorm(100),rnorm(100), "elke", col = rainbow(100))
while(T) {text(rnorm(100),rnorm(100), "elke", col = rainbow(100))}
grace   6  bhjbhvghbhbcgguiiuihuhhhjhjhhkbh,kmm kl,mmmm
m
mum <- "Simone"
dad <- "Michael"
library(trip)
x <- triplib::trips0[1:30, ]
diff(x$date)
library(dplyr)
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~tibble::tibble(x = approx(x, x1, n = nn)))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~tibble::tibble(x = approx(.x$x, .x$x1, n = .x$nn)))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~tibble::tibble(x =.x$x, y = .x$x1, n = .x$nn))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~tibble::tibble(x = approx(.x$x, .x$x1, n = .x$nn)$y))
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{browser(); tibble::tibble(x = approx(.x$x, .x$x1, n = .x$nn)$y)})
.x
approx(.x$x, .x$x1, n = .x$nn)
?approx
.x$x
.x$x1
.x$nn
approx(c(.x$x, .x$x1), n = .x$nn)
approx(c(.x$x, .x$x1), n = .x$nn)$y
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{browser(); tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point()
library(ggplot2)
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point()
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_line(data = x)
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_line(data = x, colour = "black")
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_path(data = x, colour = "black")
library(trip)
x <- triplib::trips0
diff(x$date)
library(dplyr)
library(ggplot2)
diftime <- 36
x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)}) %>%
ggplot(aes(x, y, colour = date)) + geom_point() + geom_path(data = x, colour = "black")
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y)})
})
plot(tr)
plot(tr$x, tr$y, pch = ".")
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
tr
g <- raster::raster(tr[c("x", "y")])
g
g <- raster::raster(as.matrix(tr[c("x", "y")]))
g
g <- raster::raster(raster::extent(as.matrix(tr[c("x", "y")])))
g
g <- raster::raster(raster::extent(as.matrix(tr[c("x", "y")])), res = .2)
g
cell <- raster::cellFromXY(g, tr[c("x", "y")])
cell <- raster::cellFromXY(g, as.matrix(tr[c("x", "y")]))
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell
cell <- cell %>% group_by(object_) %>% count()
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% tally()
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% summarize(n = n())
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell <- cell %>% group_by(object_) %>% summarize(n = sum(n()))
cell
cell
cell <- tabularaster::cellnumbers(g, as.matrix(tr[c("x", "y")]))
cell
cell <- cell %>% group_by(cell_) %>% summarize(n = sum(n()))
cell
g[cell$cell_] <- cell$n
plot(g)
plot(aggregate(g,fact = 8, fun = sum))
plot(raster::aggregate(g,fact = 8, fun = sum))
lines(tr$x, tr$y)
trp <- trip(tr)
trp <- trip(x)
plot(trp)
system.time({
trip:::interpequal(trp, dur = diftime)})
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
purrr::map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
system.time({
aa <- trip:::interpequal(trp, dur = diftime)})
library(furrr)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
x <- do.call(rbind, replicate(x, 100, simplify = FALSE))
x <- do.call(rbind, replicate(100, x, simplify = FALSE))
dim(x)
dim(triplib::trips0)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
plan(multifork)
library(trip)
x <- triplib::trips0
x <- do.call(rbind, replicate(10, x, simplify = FALSE))
diff(x$date)
library(dplyr)
library(ggplot2)
diftime <- 36
library(furrr)
plan(multicore)
system.time({
tr <-   x %>% group_by(id) %>%
mutate(duration = lead(unclass(date), 1L) - unclass(date)) %>%
mutate(nn = pmax(3L, round(duration / diftime))) %>%
mutate(x1 = lead(x, 1), y1 = lead(y, 1), t1 = lead(date, 1)) %>%
slice(-n()) %>%
ungroup() %>%
purrr::transpose() %>%
furrr::future_map_dfr(~{ tibble::tibble(x = approx(c(.x$x, .x$x1), n = .x$nn)$y,
y = approx(c(.x$y, .x$y1), n = .x$nn)$y,
date = approx(c(.x$date, .x$t1), n = .x$nn)$y,
id = .x$id)})
})
trp <- trip(x)
system.time({
aa <- trip:::interpequal(trp, dur = diftime)})
dim(trp)
